# データ形式定義

## 譲渡益税明細 (`jotoeki`)

- **ファイルエンコーディング:** Shift-JIS
- **ヘッダー:**
    - 1行目から20行目まではファイルの集計期間などのメタ情報が含まれるため、読み飛ばす必要がある。
    - 実際のヘッダー行（列名）は21行目。
- **データ:**
    - データ本体は22行目から開始される。
- **データ読み込み時の注意点:**
    - `pandas.read_csv` を使用する際は、`skiprows=20` と `encoding='shift-jis'` のオプションを指定する必要がある。

---
### カラム定義

証券会社の公式ドキュメントは下記
https://search.sbisec.co.jp/v2/popwin/help/manage_13_01.html

ファイルのヘッダー行（21行目）には13列（最後に「地方税」カラム）存在しますが、データ本体（22行目以降）は12列しかありません。
この列数の不一致が原因で、Pandasは正しくファイルを読み込めません。

SBI証券のヘルプによると、以下の通りであり、俺の取引はこれに該当するため「地方
税」が無いのだ。
> ※源泉徴収なし（確定申告）をご選択のお客様は損益金額のみ表示

この問題を解決するため、読み込み時はファイルのヘッダー行をスキップし（`skiprows=21`）、以下の12列に対応するカラム名をプログラム側で指定する必要があります。

| No. | プログラム用列名 | CSVヘッダー列名 | 内容 |
|---|---|---|---|
| 1 | `ticker_code` | 銘柄コード | 銘柄のティッカーコード |
| 2 | `name` | 銘柄 | 銘柄名 |
| 3 | `cancellation_category` | 譲渡益取消区分 | 譲渡益の取消区分（通常は空欄） |
| 4 | `contract_date` | 約定日 | 取引が成立した日 |
| 5 | `quantity` | 数量 | 取引された株式数 |
| 6 | `transaction_type`| 取引 | 「現物売」「信用返済売」などの取引種別 |
| 7 | `delivery_date` | 受渡日 | 決済が行われた日 |
| 8 | `sale_price` | 売却/決済金額 | 売却または決済の金額（円） |
| 9 | `commission` | 費用 | 取引にかかった手数料（円） |
| 10 | `acquisition_date` | 取得/新規年月日 | 株式を取得した日 |
| 11 | `acquisition_price` | 取得/新規金額 | 取得にかかった金額（円） |
| 12 | `profit_loss` | 損益金額/徴収額 | 税引き前の損益金額（円） |

---

## 約定履歴 (`yakujo`)

- **ファイルエンコーディング:** Shift-JIS
- **ヘッダー:**
    - 1行目から7行目まではファイルの集計期間などのメタ情報が含まれるため、読み飛ばす必要がある。
    - 実際のヘッダー行（列名）は8行目。
- **データ:**
    - データ本体は9行目から開始される。
- **データ読み込み時の注意点:**
    - `pandas.read_csv` を使用する際は、`skiprows=7` と `encoding='shift-jis'` のオプションを指定する。

### カラム定義

証券会社の公式ドキュメントは下記
https://search.sbisec.co.jp/v2/popwin/help/manage_10_01.html

| No. | プログラム用列名 | CSVヘッダー列名 | 内容 |
|---|---|---|---|
| 1 | `contract_date` | 約定日 | 取引が成立した日 |
| 2 | `name` | 銘柄 | 銘柄名 |
| 3 | `ticker_code` | 銘柄コード | 銘柄のティッカーコード |
| 4 | `market` | 市場 | 取引が行われた市場（「東証」など） |
| 5 | `transaction_type` | 取引 | 「信用返済売」「株式現物売」などの取引種別 |
| 6 | `period` | 期限 | 信用取引の建玉期限（「6ヶ月」など） |
| 7 | `account_type` | 預り | 預り区分（「特定」「NISA(成)」など） |
| 8 | `tax_category` | 課税 | 課税区分（「申告」など） |
| 9 | `quantity` | 約定数量 | 約定した株式数 |
| 10 | `unit_price` | 約定単価 | 1株あたりの約定価格（円） |
| 11 | `commission` | 手数料/諸経費等 | 取引にかかった手数料と諸経費（円） |
| 12 | `tax` | 税額 | 税額（円） |
| 13 | `delivery_date` | 受渡日 | 決済が行われた日 |
| 14 | `settlement_amount` | 受渡金額/決済損益 | 受渡金額または決済損益（円） | 
